/**
 * Advanced Analytics Screen
 * Privacy-first local analytics dashboard
 * All calculations happen on-device using local workout data
 */

import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  SafeAreaView,
  TouchableOpacity,
  ActivityIndicator,
} from 'react-native';
import { useNavigation } from '@react-navigation/native';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { Ionicons } from '@expo/vector-icons';
import { theme } from '../styles/theme';
import { PrivacyNoticeModal } from '../components/ui/PrivacyNoticeModal';
import localWorkoutStorage from '../services/fitness/LocalWorkoutStorageService';
import type { LocalWorkout } from '../services/fitness/LocalWorkoutStorageService';
import unifiedCache from '../services/cache/UnifiedNostrCache';
import { CacheKeys, CacheTTL } from '../constants/cacheTTL';
import { Nuclear1301Service } from '../services/fitness/Nuclear1301Service';
import type { NostrWorkout } from '../types/nostrWorkout';
import type {
  AnalyticsSummary,
  HealthProfile,
} from '../types/analytics';
import { CardioPerformanceAnalytics } from '../services/analytics/CardioPerformanceAnalytics';
import { BodyCompositionAnalytics } from '../services/analytics/BodyCompositionAnalytics';
import { CaloricAnalyticsService } from '../services/analytics/CaloricAnalyticsService';
import { StreakAnalyticsService } from '../services/analytics/StreakAnalyticsService';
import Nostr1301ImportService from '../services/fitness/Nostr1301ImportService';
import { HealthSnapshotCard } from '../components/analytics/HealthSnapshotCard';
import { CalorieBalanceCard } from '../components/analytics/CalorieBalanceCard';
import { ActivityStreaksCard } from '../components/analytics/ActivityStreaksCard';

const PRIVACY_NOTICE_KEY = '@runstr:analytics_privacy_accepted';
const HEALTH_PROFILE_KEY = '@runstr:health_profile';

export const AdvancedAnalyticsScreen: React.FC = () => {
  const navigation = useNavigation();
  const [loading, setLoading] = useState(true);
  const [showPrivacyModal, setShowPrivacyModal] = useState(false);
  const [workouts, setWorkouts] = useState<LocalWorkout[]>([]);
  const [analytics, setAnalytics] = useState<AnalyticsSummary | null>(null);
  const [healthProfile, setHealthProfile] = useState<HealthProfile | null>(null);
  const [hasImported, setHasImported] = useState(false);
  const [importing, setImporting] = useState(false);
  const [importStats, setImportStats] = useState<{
    totalImported: number;
    importedAt: string;
  } | null>(null);
  const [activityStreaks, setActivityStreaks] = useState<any[]>([]);
  const [caloricMetrics, setCaloricMetrics] = useState<any>(null);

  useEffect(() => {
    initializeAnalytics();
  }, []);

  const initializeAnalytics = async () => {
    try {
      // Check if user has accepted privacy notice
      const privacyAccepted = await AsyncStorage.getItem(PRIVACY_NOTICE_KEY);

      if (!privacyAccepted) {
        setShowPrivacyModal(true);
        setLoading(false);
        return;
      }

      // Load and calculate analytics
      await loadAnalytics();
    } catch (error) {
      console.error('Failed to initialize analytics:', error);
      setLoading(false);
    }
  };

  const loadAnalytics = async () => {
    try {
      setLoading(true);
      console.log(
        '[AdvancedAnalytics] Loading analytics with complete workout dataset...'
      );

      // Load health profile
      const profileData = await AsyncStorage.getItem(HEALTH_PROFILE_KEY);
      const profile: HealthProfile | null = profileData
        ? JSON.parse(profileData)
        : null;
      setHealthProfile(profile);

      // Check if 1301 import has been completed
      const importCompleted = await Nostr1301ImportService.hasImported();
      setHasImported(importCompleted);

      // Load import stats if available
      if (importCompleted) {
        const stats = await localWorkoutStorage.getNostrImportStats();
        if (stats) {
          setImportStats({
            totalImported: stats.totalImported,
            importedAt: stats.importedAt,
          });
        }
      }

      // Get ALL local workouts (includes GPS, manual, daily steps, AND imported Nostr)
      const allWorkouts = await localWorkoutStorage.getAllWorkouts();
      console.log(
        `[AdvancedAnalytics] Total workouts for analytics: ${allWorkouts.length}`
      );
      setWorkouts(allWorkouts);

      // Calculate simplified analytics (5 metrics only)

      // 1. VO2 Max + Body Composition (for Health Snapshot Card)
      const cardioMetrics = profile
        ? CardioPerformanceAnalytics.calculateMetrics(allWorkouts, profile)
        : CardioPerformanceAnalytics.calculateMetrics(allWorkouts);

      const bodyComposition =
        profile && (profile.weight || profile.height)
          ? BodyCompositionAnalytics.calculateMetrics(profile, allWorkouts)
          : undefined;

      // 2. Caloric Balance (for Weekly Calorie Balance)
      const caloricMetrics = CaloricAnalyticsService.calculateMetrics(
        allWorkouts,
        profile || undefined
      );

      // 3. Activity Streaks (for Activity Streaks Card)
      const activityStreaks = StreakAnalyticsService.calculateActivityStreaks(
        allWorkouts
      );

      // Store simplified analytics
      const summary: AnalyticsSummary = {
        cardio: cardioMetrics || undefined,
        bodyComposition: bodyComposition || undefined,
        lastUpdated: new Date().toISOString(),
      };

      setAnalytics(summary);
      setActivityStreaks(activityStreaks);
      setCaloricMetrics(caloricMetrics);
      setLoading(false);
      console.log('[AdvancedAnalytics] ‚úÖ Analytics calculation complete');
    } catch (error) {
      console.error('[AdvancedAnalytics] ‚ùå Failed to load analytics:', error);
      setLoading(false);
    }
  };

  const handlePrivacyAccept = async () => {
    try {
      await AsyncStorage.setItem(PRIVACY_NOTICE_KEY, 'true');
      setShowPrivacyModal(false);
      await loadAnalytics();
    } catch (error) {
      console.error('Failed to save privacy acceptance:', error);
    }
  };

  const handlePrivacyClose = () => {
    setShowPrivacyModal(false);
    navigation.goBack(); // Go back if user declines
  };

  const handlePrivacyBannerPress = () => {
    setShowPrivacyModal(true);
  };

  const handleImportNostrHistory = async () => {
    try {
      setImporting(true);

      // Get user's pubkey
      const userPubkey = await AsyncStorage.getItem('@runstr:npub');
      const hexPubkey = await AsyncStorage.getItem('@runstr:hex_pubkey');
      const pubkey = hexPubkey || userPubkey;

      if (!pubkey) {
        console.error('No pubkey found - cannot import workouts');
        setImporting(false);
        return;
      }

      console.log('[AdvancedAnalytics] Starting Nostr workout import...');

      // Import workouts with progress tracking
      const result = await Nostr1301ImportService.importUserHistory(
        pubkey,
        (progress) => {
          console.log(
            `[Import Progress] ${progress.imported}/${progress.total} - ${progress.current}`
          );
          // Update import stats to show progress
          setImportStats({
            totalImported: progress.imported,
            importedAt: new Date().toISOString(),
          });
        }
      );

      if (result.success) {
        console.log(
          `[AdvancedAnalytics] ‚úÖ Import successful: ${result.totalImported} workouts`
        );
        setHasImported(true);
        setImportStats({
          totalImported: result.totalImported,
          importedAt: new Date().toISOString(),
        });

        // Reload analytics with newly imported data
        await loadAnalytics();
      } else {
        console.error('[AdvancedAnalytics] Import failed:', result.error);
      }

      setImporting(false);
    } catch (error) {
      console.error('[AdvancedAnalytics] Import error:', error);
      setImporting(false);
    }
  };

  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color="#FF9D42" />
          <Text style={styles.loadingText}>Calculating analytics...</Text>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      {/* Header */}
      <View style={styles.header}>
        <TouchableOpacity
          onPress={() => navigation.goBack()}
          style={styles.backButton}
        >
          <Ionicons name="arrow-back" size={24} color={theme.colors.text} />
        </TouchableOpacity>
        <Text style={styles.headerTitle}>Advanced Analytics</Text>
        <View style={styles.headerSpacer} />
      </View>

      {/* Content */}
      <ScrollView
        style={styles.content}
        contentContainerStyle={styles.contentContainer}
      >
        {/* Privacy Notice Banner */}
        <TouchableOpacity
          style={styles.privacyNotice}
          onPress={handlePrivacyBannerPress}
        >
          <View style={styles.privacyHeader}>
            <Ionicons name="lock-closed" size={20} color="#FF9D42" />
            <Text style={styles.privacyTitle}>Your Data Stays Private</Text>
          </View>
          <Text style={styles.privacyText}>
            All analytics calculated locally on your device. Your data never
            leaves your phone.
          </Text>
          <Text style={styles.privacyLink}>Tap to learn more ‚Üí</Text>
        </TouchableOpacity>

        {/* Import Nostr History Button (always visible) */}
        <TouchableOpacity
          style={styles.importButton}
          onPress={handleImportNostrHistory}
          disabled={importing}
        >
          <Ionicons name="cloud-download-outline" size={20} color="#000" />
          <Text style={styles.importButtonText}>
            {importing
              ? `Importing... (${importStats?.totalImported || 0} workouts)`
              : importStats
              ? '‚úì Re-import Nostr Workouts'
              : 'Import Nostr Workouts'}
          </Text>
        </TouchableOpacity>
        {importStats && !importing && (
          <Text style={styles.importStats}>
            Last imported: {importStats.totalImported} workouts on{' '}
            {new Date(importStats.importedAt).toLocaleDateString()}
          </Text>
        )}

        {/* Section 1: Health Snapshot (BMI | VO2 Max | Fitness Age) */}
        <Text style={styles.sectionTitle}>Health Metrics</Text>
        <HealthSnapshotCard
          bodyComposition={analytics?.bodyComposition}
          vo2MaxData={analytics?.cardio?.vo2MaxEstimate}
        />

        {/* Section 2: Weekly Caloric Balance */}
        {caloricMetrics && (
          <View style={styles.section}>
            <Text style={styles.sectionTitle}>Weekly Caloric Balance</Text>
            <CalorieBalanceCard
              dailyBalance={caloricMetrics.today}
              weeklyAverage={CaloricAnalyticsService.calculateWeeklyAverage(
                workouts
              )}
            />
          </View>
        )}

        {/* Section 3: Activity Streaks */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Activity Streaks</Text>
          <ActivityStreaksCard streaks={activityStreaks} />
        </View>

        {/* Last Updated */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Overall Health Score</Text>
              {analytics?.holisticScore ? (
                <>
                  <View style={styles.scoreCard}>
                    <View style={styles.scoreCircle}>
                      <Text style={styles.scoreValue}>
                        {analytics.holisticScore.overall}
                      </Text>
                      <Text style={styles.scoreLabel}>/ 100</Text>
                    </View>
                    <View style={styles.scoreDetails}>
                      <Text style={styles.categoryLabel}>
                        {analytics.holisticScore.category.toUpperCase()}
                      </Text>
                      <Text style={styles.trendLabel}>
                        Trend:{' '}
                        {analytics.holisticScore.trend === 'improving'
                          ? 'üìà'
                          : analytics.holisticScore.trend === 'declining'
                          ? 'üìâ'
                          : '‚û°Ô∏è'}{' '}
                        {analytics.holisticScore.trend}
                      </Text>
                    </View>
                  </View>

                {/* Category Breakdown */}
                <View style={styles.categoryBreakdown}>
                  {analytics.holisticScore.cardio > 0 && (
                    <View style={styles.categoryRow}>
                      <Text style={styles.categoryName}>Cardio</Text>
                      <View style={styles.progressBar}>
                        <View
                          style={[
                            styles.progressFill,
                            { width: `${analytics.holisticScore.cardio}%` },
                          ]}
                        />
                      </View>
                      <Text style={styles.categoryScore}>
                        {analytics.holisticScore.cardio}
                      </Text>
                    </View>
                  )}
                  {analytics.holisticScore.strength > 0 && (
                    <View style={styles.categoryRow}>
                      <Text style={styles.categoryName}>Strength</Text>
                      <View style={styles.progressBar}>
                        <View
                          style={[
                            styles.progressFill,
                            { width: `${analytics.holisticScore.strength}%` },
                          ]}
                        />
                      </View>
                      <Text style={styles.categoryScore}>
                        {analytics.holisticScore.strength}
                      </Text>
                    </View>
                  )}
                  {analytics.holisticScore.wellness > 0 && (
                    <View style={styles.categoryRow}>
                      <Text style={styles.categoryName}>Wellness</Text>
                      <View style={styles.progressBar}>
                        <View
                          style={[
                            styles.progressFill,
                            { width: `${analytics.holisticScore.wellness}%` },
                          ]}
                        />
                      </View>
                      <Text style={styles.categoryScore}>
                        {analytics.holisticScore.wellness}
                      </Text>
                    </View>
                  )}
                  {analytics.holisticScore.nutrition > 0 && (
                    <View style={styles.categoryRow}>
                      <Text style={styles.categoryName}>Nutrition</Text>
                      <View style={styles.progressBar}>
                        <View
                          style={[
                            styles.progressFill,
                            { width: `${analytics.holisticScore.nutrition}%` },
                          ]}
                        />
                      </View>
                      <Text style={styles.categoryScore}>
                        {analytics.holisticScore.nutrition}
                      </Text>
                    </View>
                  )}
                  <View style={styles.categoryRow}>
                    <Text style={styles.categoryName}>Balance</Text>
                    <View style={styles.progressBar}>
                      <View
                        style={[
                          styles.progressFill,
                          { width: `${analytics.holisticScore.balance}%` },
                        ]}
                      />
                    </View>
                    <Text style={styles.categoryScore}>
                      {analytics.holisticScore.balance}
                    </Text>
                  </View>
                </View>

                  {/* Recommendations */}
                  {analytics.holisticScore.recommendations.length > 0 && (
                    <View style={styles.recommendations}>
                      <Text style={styles.recommendationsTitle}>
                        Recommendations
                      </Text>
                      {analytics.holisticScore.recommendations.map(
                        (rec, index) => (
                          <View key={index} style={styles.recommendationRow}>
                            <Ionicons
                              name="bulb-outline"
                              size={16}
                              color="#FF9D42"
                            />
                            <Text style={styles.recommendationText}>{rec}</Text>
                          </View>
                        )
                      )}
                    </View>
                  )}
                </>
              ) : (
                <View style={styles.metricCard}>
                  <View style={styles.emptyMetricState}>
                    <Ionicons
                      name="bar-chart-outline"
                      size={48}
                      color={theme.colors.textMuted}
                    />
                    <Text style={styles.emptyMetricTitle}>
                      Track workouts to see your score
                    </Text>
                    <Text style={styles.emptyMetricText}>
                      Your overall health score will appear here once you start tracking workouts
                    </Text>
                  </View>
                </View>
              )}
            </View>

            {/* Cardio Performance Section - Always visible */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Cardio Performance</Text>
              {analytics?.cardio ? (
                <View style={styles.metricCard}>
                  <View style={styles.metricRow}>
                    <Text style={styles.metricLabel}>Average Pace</Text>
                    <Text style={styles.metricValue}>
                      {Math.floor(
                        analytics.cardio.paceImprovement.currentAvgPace / 60
                      )}
                      :
                      {String(
                        Math.round(
                          analytics.cardio.paceImprovement.currentAvgPace % 60
                        )
                      ).padStart(2, '0')}{' '}
                      /km
                    </Text>
                    {analytics.cardio.paceImprovement.percentChange !== 0 && (
                      <Text
                        style={[
                          styles.metricTrend,
                          analytics.cardio.paceImprovement.trend ===
                            'improving' && styles.metricTrendPositive,
                        ]}
                      >
                        {analytics.cardio.paceImprovement.percentChange > 0
                          ? '+'
                          : ''}
                        {analytics.cardio.paceImprovement.percentChange.toFixed(
                          1
                        )}
                        %
                      </Text>
                    )}
                  </View>
                  <View style={styles.metricRow}>
                    <Text style={styles.metricLabel}>Weekly Distance</Text>
                    <Text style={styles.metricValue}>
                      {analytics.cardio.distanceProgression.currentWeeklyAvg.toFixed(
                        1
                      )}{' '}
                      km
                    </Text>
                    {analytics.cardio.distanceProgression.percentChange !== 0 && (
                      <Text
                        style={[
                          styles.metricTrend,
                          analytics.cardio.distanceProgression.trend ===
                            'increasing' && styles.metricTrendPositive,
                        ]}
                      >
                        {analytics.cardio.distanceProgression.percentChange > 0
                          ? '+'
                          : ''}
                        {analytics.cardio.distanceProgression.percentChange.toFixed(
                          1
                        )}
                        %
                      </Text>
                    )}
                  </View>
                  {analytics.cardio.vo2MaxEstimate && (
                    <View style={styles.metricRow}>
                      <Text style={styles.metricLabel}>VO‚ÇÇ Max Estimate</Text>
                      <Text style={styles.metricValue}>
                        {analytics.cardio.vo2MaxEstimate.estimate.toFixed(1)}{' '}
                        ml/kg/min
                      </Text>
                      <Text style={styles.metricSubtext}>
                        {analytics.cardio.vo2MaxEstimate.category}
                      </Text>
                    </View>
                  )}
                </View>
              ) : (
                <View style={styles.metricCard}>
                  <View style={styles.emptyMetricState}>
                    <Ionicons
                      name="walk-outline"
                      size={48}
                      color={theme.colors.textMuted}
                    />
                    <Text style={styles.emptyMetricTitle}>
                      Track your first run
                    </Text>
                    <Text style={styles.emptyMetricText}>
                      Record cardio workouts to see pace, distance, and VO‚ÇÇ Max estimates
                    </Text>
                  </View>
                </View>
              )}
            </View>

            {/* Strength Training Section - Always visible */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Strength Training</Text>
              {analytics?.strength &&
              analytics.strength.volumeProgression.currentMonthlyVolume > 0 ? (
                <View style={styles.metricCard}>
                  <View style={styles.metricRow}>
                    <Text style={styles.metricLabel}>Monthly Volume</Text>
                    <Text style={styles.metricValue}>
                      {
                        analytics.strength.volumeProgression
                          .currentMonthlyVolume
                      }{' '}
                      reps
                    </Text>
                    {analytics.strength.volumeProgression.percentChange !==
                      0 && (
                      <Text
                        style={[
                          styles.metricTrend,
                          analytics.strength.volumeProgression.trend ===
                            'increasing' && styles.metricTrendPositive,
                        ]}
                      >
                        {analytics.strength.volumeProgression.percentChange >
                        0
                          ? '+'
                          : ''}
                        {analytics.strength.volumeProgression.percentChange.toFixed(
                          1
                        )}
                        %
                      </Text>
                    )}
                  </View>
                  {analytics.strength.workoutDensity.avgRepsPerMinute > 0 && (
                    <View style={styles.metricRow}>
                      <Text style={styles.metricLabel}>Workout Density</Text>
                      <Text style={styles.metricValue}>
                        {analytics.strength.workoutDensity.avgRepsPerMinute.toFixed(
                          1
                        )}{' '}
                        reps/min
                      </Text>
                    </View>
                  )}
                </View>
              ) : (
                <View style={styles.metricCard}>
                  <View style={styles.emptyMetricState}>
                    <Ionicons
                      name="barbell-outline"
                      size={48}
                      color={theme.colors.textMuted}
                    />
                    <Text style={styles.emptyMetricTitle}>
                      Log your first strength workout
                    </Text>
                    <Text style={styles.emptyMetricText}>
                      Track sets, reps, and exercises to see volume progression and workout density
                    </Text>
                  </View>
                </View>
              )}
            </View>

            {/* Wellness Section - Always visible */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Wellness & Recovery</Text>
              {analytics?.wellness ? (
                <View style={styles.metricCard}>
                  <View style={styles.metricRow}>
                    <Text style={styles.metricLabel}>Meditation Streak</Text>
                    <Text style={styles.metricValue}>
                      {analytics.wellness.meditationConsistency.streak} days
                    </Text>
                    <Text style={styles.metricSubtext}>
                      Best:{' '}
                      {analytics.wellness.meditationConsistency.longestStreak}{' '}
                      days
                    </Text>
                  </View>
                  <View style={styles.metricRow}>
                    <Text style={styles.metricLabel}>Average Session</Text>
                    <Text style={styles.metricValue}>
                      {Math.floor(
                        analytics.wellness.sessionDuration.avgDuration / 60
                      )}{' '}
                      min{' '}
                      {Math.round(
                        analytics.wellness.sessionDuration.avgDuration % 60
                      )}{' '}
                      sec
                    </Text>
                  </View>
                </View>
              ) : (
                <View style={styles.metricCard}>
                  <View style={styles.emptyMetricState}>
                    <Ionicons
                      name="flower-outline"
                      size={48}
                      color={theme.colors.textMuted}
                    />
                    <Text style={styles.emptyMetricTitle}>
                      Try meditation or recovery activities
                    </Text>
                    <Text style={styles.emptyMetricText}>
                      Track meditation, yoga, and recovery sessions to see wellness patterns
                    </Text>
                  </View>
                </View>
              )}
            </View>

            {/* Insights & Correlations Section */}
            {(() => {
              // Check if ANY correlation exists before rendering section
              const hasAnyCorrelation =
                analytics.correlations &&
                (analytics.correlations.meditationVsRecovery ||
                  analytics.correlations.strengthVsCardio ||
                  analytics.correlations.consistencyVsPerformance ||
                  analytics.correlations.mealTimingVsAdherence);

              if (!hasAnyCorrelation) return null;

              return (
                <View style={styles.section}>
                  <Text style={styles.sectionTitle}>
                    Insights & Correlations
                  </Text>
                  {analytics.correlations!.meditationVsRecovery && (
                    <CorrelationInsightCard
                      title="Meditation ‚Üí Recovery Time"
                      correlation={analytics.correlations!.meditationVsRecovery}
                      icon="fitness-outline"
                    />
                  )}
                  {analytics.correlations!.strengthVsCardio && (
                    <CorrelationInsightCard
                      title="Strength ‚Üí Cardio Performance"
                      correlation={analytics.correlations!.strengthVsCardio}
                      icon="barbell-outline"
                    />
                  )}
                  {analytics.correlations!.consistencyVsPerformance && (
                    <CorrelationInsightCard
                      title="Workout Frequency ‚Üí Performance"
                      correlation={
                        analytics.correlations!.consistencyVsPerformance
                      }
                      icon="trending-up-outline"
                    />
                  )}
                  {analytics.correlations!.mealTimingVsAdherence && (
                    <CorrelationInsightCard
                      title="Meal Timing ‚Üí Diet Adherence"
                      correlation={analytics.correlations!.mealTimingVsAdherence}
                      icon="restaurant-outline"
                    />
                  )}
                </View>
              );
            })()}

        {/* Last Updated */}
        {analytics && (
          <Text style={styles.lastUpdated}>
            Last updated: {new Date(analytics.lastUpdated).toLocaleString()}
          </Text>
        )}
      </ScrollView>

      {/* Privacy Notice Modal */}
      <PrivacyNoticeModal
        visible={showPrivacyModal}
        onClose={handlePrivacyClose}
        onAccept={handlePrivacyAccept}
      />
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: theme.colors.background,
  },

  header: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 16,
    backgroundColor: theme.colors.cardBackground,
    borderBottomWidth: 1,
    borderBottomColor: theme.colors.border,
  },

  backButton: {
    padding: 8,
  },

  headerTitle: {
    flex: 1,
    fontSize: 18,
    fontWeight: theme.typography.weights.semiBold,
    color: theme.colors.text,
    textAlign: 'center',
  },

  headerSpacer: {
    width: 40,
  },

  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    gap: 16,
  },

  loadingText: {
    fontSize: 16,
    color: '#FF9D42',
    fontWeight: theme.typography.weights.medium,
  },

  content: {
    flex: 1,
  },

  contentContainer: {
    padding: 16,
    paddingBottom: 100,
  },

  privacyNotice: {
    backgroundColor: '#0a0a0a',
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#1a1a1a',
    padding: 16,
    marginBottom: 24,
  },

  privacyHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 8,
    marginBottom: 8,
  },

  privacyTitle: {
    fontSize: 16,
    fontWeight: theme.typography.weights.semiBold,
    color: '#FFB366',
  },

  privacyText: {
    fontSize: 14,
    color: '#CC7A33',
    lineHeight: 20,
    marginBottom: 8,
  },

  privacyLink: {
    fontSize: 13,
    color: '#FF9D42',
    fontWeight: theme.typography.weights.medium,
  },

  importButton: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    backgroundColor: '#FF9D42',
    borderRadius: 12,
    padding: 16,
    gap: 8,
    marginBottom: 24,
  },

  importButtonText: {
    fontSize: 15,
    fontWeight: theme.typography.weights.semiBold,
    color: '#000',
  },

  emptyState: {
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 80,
  },

  emptyStateTitle: {
    fontSize: 20,
    fontWeight: theme.typography.weights.semiBold,
    color: theme.colors.text,
    marginTop: 16,
    marginBottom: 8,
  },

  emptyStateText: {
    fontSize: 14,
    color: theme.colors.textSecondary,
    textAlign: 'center',
    paddingHorizontal: 32,
    lineHeight: 20,
  },

  section: {
    marginBottom: 32,
  },

  sectionTitle: {
    fontSize: 18,
    fontWeight: theme.typography.weights.semiBold,
    color: '#FFB366',
    marginBottom: 16,
  },

  scoreCard: {
    backgroundColor: '#0a0a0a',
    borderRadius: 16,
    borderWidth: 1,
    borderColor: '#1a1a1a',
    padding: 24,
    flexDirection: 'row',
    alignItems: 'center',
    gap: 24,
    marginBottom: 16,
  },

  scoreCircle: {
    width: 100,
    height: 100,
    borderRadius: 50,
    backgroundColor: '#FF9D42' + '15',
    borderWidth: 3,
    borderColor: '#FF9D42',
    alignItems: 'center',
    justifyContent: 'center',
  },

  scoreValue: {
    fontSize: 32,
    fontWeight: theme.typography.weights.bold,
    color: '#FF9D42',
  },

  scoreLabel: {
    fontSize: 14,
    color: '#CC7A33',
  },

  scoreDetails: {
    flex: 1,
  },

  categoryLabel: {
    fontSize: 20,
    fontWeight: theme.typography.weights.bold,
    color: theme.colors.text,
    marginBottom: 8,
  },

  trendLabel: {
    fontSize: 14,
    color: theme.colors.textSecondary,
  },

  categoryBreakdown: {
    backgroundColor: '#0a0a0a',
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#1a1a1a',
    padding: 16,
    gap: 16,
  },

  categoryRow: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 12,
  },

  categoryName: {
    width: 80,
    fontSize: 14,
    fontWeight: theme.typography.weights.medium,
    color: theme.colors.text,
  },

  progressBar: {
    flex: 1,
    height: 8,
    backgroundColor: '#1a1a1a',
    borderRadius: 4,
    overflow: 'hidden',
  },

  progressFill: {
    height: '100%',
    backgroundColor: '#FF9D42',
    borderRadius: 4,
  },

  categoryScore: {
    width: 40,
    fontSize: 14,
    fontWeight: theme.typography.weights.semiBold,
    color: '#FF9D42',
    textAlign: 'right',
  },

  recommendations: {
    backgroundColor: '#0a0a0a',
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#1a1a1a',
    padding: 16,
    marginTop: 16,
  },

  recommendationsTitle: {
    fontSize: 16,
    fontWeight: theme.typography.weights.semiBold,
    color: theme.colors.text,
    marginBottom: 12,
  },

  recommendationRow: {
    flexDirection: 'row',
    alignItems: 'flex-start',
    gap: 12,
    marginBottom: 8,
  },

  recommendationText: {
    flex: 1,
    fontSize: 14,
    color: theme.colors.textSecondary,
    lineHeight: 20,
  },

  metricCard: {
    backgroundColor: '#0a0a0a',
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#1a1a1a',
    padding: 16,
    gap: 16,
  },

  metricRow: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
  },

  metricLabel: {
    flex: 1,
    fontSize: 14,
    color: theme.colors.textSecondary,
  },

  metricValue: {
    fontSize: 16,
    fontWeight: theme.typography.weights.semiBold,
    color: theme.colors.text,
    marginRight: 12,
  },

  metricTrend: {
    fontSize: 14,
    fontWeight: theme.typography.weights.medium,
    color: theme.colors.textMuted,
  },

  metricTrendPositive: {
    color: theme.colors.orangeBright,
  },

  metricSubtext: {
    fontSize: 12,
    color: theme.colors.textMuted,
  },

  lastUpdated: {
    fontSize: 12,
    color: theme.colors.textMuted,
    textAlign: 'center',
    marginTop: 16,
  },

  importStats: {
    fontSize: 12,
    color: theme.colors.textMuted,
    textAlign: 'center',
    marginTop: 8,
    marginBottom: 16,
  },

  emptyMetricState: {
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 32,
  },

  emptyMetricTitle: {
    fontSize: 16,
    fontWeight: theme.typography.weights.semiBold,
    color: theme.colors.text,
    marginTop: 16,
    marginBottom: 8,
    textAlign: 'center',
  },

  emptyMetricText: {
    fontSize: 14,
    color: theme.colors.textSecondary,
    textAlign: 'center',
    paddingHorizontal: 16,
    lineHeight: 20,
  },
});
